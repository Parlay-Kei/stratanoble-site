(()=>{var e={};e.id=225,e.ids=[225],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{"use strict";e.exports=require("tls")},39727:()=>{},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},47990:()=>{},53880:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>A,routeModule:()=>v,serverHooks:()=>g,workAsyncStorage:()=>q,workUnitAsyncStorage:()=>j});var s={};t.r(s),t.d(s,{POST:()=>h});var i=t(96559),a=t(48088),o=t(37719),n=t(32190),u=t(66437),l=t(72289),p=t(35282);let c=process.env.SUPABASE_URL,d=process.env.SUPABASE_SERVICE_ROLE,m=process.env.MAILCHIMP_API_KEY,x=process.env.MAILCHIMP_AUDIENCE_ID,f=c&&d?(0,u.UU)(c,d):null,w=l.Ik({fullName:l.Yj().min(1,"Full name is required").trim(),email:l.Yj().email("Invalid email format").toLowerCase(),source:l.Yj().optional().default("web")});async function h(e){try{let r=await e.json(),t=w.safeParse(r);if(!t.success)return n.NextResponse.json({error:"Invalid request data",details:t.error.errors},{status:400});let{fullName:s,email:i,source:a}=t.data;if(!f)return n.NextResponse.json({error:"Database configuration missing"},{status:500});let{data:o}=await f.from("workshop_waitlist").select("id").eq("email",i.toLowerCase()).single();if(o)return n.NextResponse.json({error:"You are already on the waitlist!"},{status:409});let{data:u,error:l}=await f.from("workshop_waitlist").insert([{full_name:s.trim(),email:i.toLowerCase().trim(),source:a}]).select().single();if(l)return console.error("Supabase insert error:",l),n.NextResponse.json({error:"Failed to add to waitlist"},{status:500});if(m&&x)try{let e=await fetch(`https://us1.api.mailchimp.com/3.0/lists/${x}/members`,{method:"POST",headers:{Authorization:`Bearer ${m}`,"Content-Type":"application/json"},body:JSON.stringify({email_address:i.toLowerCase().trim(),status:"subscribed",merge_fields:{FNAME:s.split(" ")[0],LNAME:s.split(" ").slice(1).join(" ")||""},tags:["workshop-waitlist","side-hustle"]})});if(!e.ok){let r=await e.text();console.error("Mailchimp API error:",e.status,r)}}catch(e){console.error("Mailchimp integration error:",e)}return n.NextResponse.json({success:!0,message:"Successfully added to waitlist",data:{id:u.id,email:u.email,fullName:u.full_name}})}catch(e){if(console.error("Waitlist API error:",e),e instanceof p.G)return n.NextResponse.json({error:"Invalid request data",details:e.errors},{status:400});return n.NextResponse.json({error:"Internal server error"},{status:500})}}let v=new i.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/waitlist/route",pathname:"/api/waitlist",filename:"route",bundlePath:"app/api/waitlist/route"},resolvedPagePath:"C:\\dev\\strata-noble\\src\\app\\api\\waitlist\\route.ts",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:q,workUnitAsyncStorage:j,serverHooks:g}=v;function A(){return(0,o.patchFetch)({workAsyncStorage:q,workUnitAsyncStorage:j})}},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[447,580,437,289],()=>t(53880));module.exports=s})();