(()=>{var e={};e.id=538,e.ids=[538],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},8086:e=>{"use strict";e.exports=require("module")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},12412:e=>{"use strict";e.exports=require("assert")},28354:e=>{"use strict";e.exports=require("util")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},48161:e=>{"use strict";e.exports=require("node:os")},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},73566:e=>{"use strict";e.exports=require("worker_threads")},76760:e=>{"use strict";e.exports=require("node:path")},78335:()=>{},78474:e=>{"use strict";e.exports=require("node:events")},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},79646:e=>{"use strict";e.exports=require("child_process")},80630:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>_,routeModule:()=>p,serverHooks:()=>d,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>l});var s={};t.r(s),t.d(s,{POST:()=>u});var a=t(96559),o=t(48088),i=t(37719),n=t(32190),c=t(83256);async function u(e){try{let{sessionId:r}=await e.json();if(!r)return n.NextResponse.json({error:"Missing sessionId"},{status:400});let t=await (0,c.QW)(r);if(t.success)return n.NextResponse.json({success:!0,message:"Kickoff email sent successfully",customer_email:t.customer_email,package_type:t.package_type});return n.NextResponse.json({error:"Failed to send kickoff email"},{status:500})}catch(e){return n.NextResponse.json({error:"Internal server error"},{status:500})}}let p=new a.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/stripe/kickoff-email/route",pathname:"/api/stripe/kickoff-email",filename:"route",bundlePath:"app/api/stripe/kickoff-email/route"},resolvedPagePath:"C:\\Users\\Aspir\\Mr Hubbard\\Strata Noble\\src\\app\\api\\stripe\\kickoff-email\\route.ts",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:m,workUnitAsyncStorage:l,serverHooks:d}=p;function _(){return(0,i.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:l})}},81630:e=>{"use strict";e.exports=require("http")},83256:(e,r,t)=>{"use strict";t.d(r,{QW:()=>u,_4:()=>n,fw:()=>c});var s=t(97877),a=t(72626);let o=t.n(a)()(),i=process.env.STRIPE_SECRET_KEY;if(!i)throw Error("STRIPE_SECRET_KEY environment variable is required");let n=new s.A(i,{apiVersion:"2025-05-28.basil"});async function c(e,r,t){let s={lite:process.env.STRIPE_PRICE_ID_SOLUTION_LITE,core:process.env.STRIPE_PRICE_ID_SOLUTION_CORE,premium:process.env.STRIPE_PRICE_ID_SOLUTION_PREMIUM,workshop_standard:process.env.STRIPE_PRICE_ID_WORKSHOP_STANDARD,presence_standard:process.env.STRIPE_PRICE_ID_PRESENCE_STANDARD,analysis_standard:process.env.STRIPE_PRICE_ID_ANALYSIS_STANDARD}[e],a="https://stratanoble.com";if(!s)throw Error(`Price ID not found for package type: ${e}`);try{o.info({msg:"Creating checkout session with params",packageType:e,priceId:s,customerEmail:r,customerName:t,baseUrl:a});let i=await n.checkout.sessions.create({payment_method_types:["card"],line_items:[{price:s,quantity:1}],mode:"payment",success_url:`${a}/success?session_id={CHECKOUT_SESSION_ID}`,cancel_url:`${a}/services`,customer_email:r,metadata:{package_type:e,customer_name:t,service:"solution_services"}});if(o.info({msg:"Stripe session created successfully",id:i.id,url:i.url,status:i.status}),!i.url)throw Error("Stripe session created but no URL returned");return i}catch(e){throw o.error({msg:"Stripe checkout session creation error",error:e}),e instanceof Error&&o.error({msg:"Error details",message:e.message,stack:e.stack,name:e.name}),Error(`Failed to create checkout session: ${e instanceof Error?e.message:"Unknown error"}`)}}async function u(e){try{let r=await n.checkout.sessions.retrieve(e);if(o.info({msg:"Kickoff email should be sent to",customer_email:r.customer_email,package_type:r.metadata?.package_type,customer_name:r.metadata?.customer_name,amount_total:r.amount_total,payment_status:r.payment_status}),r.metadata?.service==="solution_services"&&r.metadata?.package_type)try{let e=await fetch("https://stratanoble.com/api/deliverables/deliver",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({customerEmail:r.customer_email,customerName:r.metadata.customer_name,packageType:r.metadata.package_type})}),t=await e.json();o.info({msg:"Deliverable delivery result",deliverableResult:t})}catch(e){o.error({msg:"Error triggering deliverable delivery",error:e})}return{success:!0,customer_email:r.customer_email,package_type:r.metadata?.package_type}}catch(e){return o.error({msg:"Error sending kickoff email",error:e}),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[447,580,330,690],()=>t(80630));module.exports=s})();